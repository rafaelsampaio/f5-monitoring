logstash:
  image: "docker.elastic.co/logstash/logstash-oss"
  antiAffinity: soft
  service:
    type: ClusterIP
    ports:
      - name: f5-waf
        port: 5144
        protocol: TCP
        targetPort: 5144
      - name: f5-ts
        port: 8514
        protocol: TCP
        targetPort: 8514
  extraPorts:
    - name: f5-waf
      containerPort: 5144
    - name: f5-ts
      containerPort: 8514
  logstashPipeline:
    f5-waf.conf: |
      input {
        syslog {
          port => 5144
          codec => plain {
            charset => "ISO-8859-1"
          }
        }
      }
      filter {
        grok {
          match => {
            "message" => [
              ",attack_type=\"%{DATA:attack_type}\"",
              ",blocking_exception_reason=\"%{DATA:blocking_exception_reason}\"",
              ",bot_anomalies=\"%{DATA:bot_anomalies}\"",
              ",bot_category=\"%{DATA:bot_category}\"",
              ",bot_signature_name=\"%{DATA:bot_signature_name}\"",
              ",client_application=\"%{DATA:client_application}\"",
              ",client_application_version=\"%{DATA:client_application_version}\"",
              ",client_class=\"%{DATA:client_class}\"",
              ",date_time=\"%{DATA:date_time}\"",
              ",dest_port=\"%{DATA:dest_port}\"",
              ",enforced_bot_anomalies=\"%{DATA:enforced_bot_anomalies}\"",
              ",grpc_method=\"%{DATA:grpc_method}\"",
              ",grpc_service=\"%{DATA:grpc_service}\"",
              ",ip_client=\"%{DATA:ip_client}\"",
              ",is_truncated=\"%{DATA:is_truncated}\"",
              ",method=\"%{DATA:method}\"",
              ",outcome=\"%{DATA:outcome}\"",
              ",outcome_reason=\"%{DATA:outcome_reason}\"",
              ",policy_name=\"%{DATA:policy_name}\"",
              ",protocol=\"%{DATA:protocol}\"",
              ",request_status=\"%{DATA:request_status}\"",
              ",request=\"%{DATA:request}\"",
              ",request_body_base64=\"%{DATA:request_body_base64}\"",
              ",response_code=\"%{DATA:response_code}\"",
              ",severity=\"%{DATA:severity}\"",
              ",sig_cves=\"%{DATA:sig_cves}\"",
              ",sig_ids=\"%{DATA:sig_ids}\"",
              ",sig_names=\"%{DATA:sig_names}\"",
              ",sig_set_names=\"%{DATA:sig_set_names}\"",
              ",src_port=\"%{DATA:src_port}\"",
              ",staged_sig_cves=\"%{DATA:staged_sig_cves}\"",
              ",staged_sig_ids=\"%{DATA:staged_sig_ids}\"",
              ",staged_sig_names=\"%{DATA:staged_sig_names}\"",
              ",staged_threat_campaign_names=\"%{DATA:staged_threat_campaign_names}\"",
              ",sub_violations=\"%{DATA:sub_violations}\"",
              ",support_id=\"%{DATA:support_id}\"",
              ",threat_campaign_names=\"%{DATA:threat_campaign_names}\"",
              ",unit_hostname=\"%{DATA:unit_hostname}\"",
              ",uri=\"%{DATA:uri}\"",
              ",violations=\"%{DATA:violations}\"",
              ",violation_details=\"%{DATA:violation_details_xml}\"",
              ",violation_rating=\"%{DATA:violation_rating}\"",
              ",vs_name=\"%{DATA:vs_name}\"",
              ",x_forwarded_for_header_value=\"%{DATA:x_forwarded_for_header_value}\""
            ]
          }
          break_on_match => false
        }
        if [violation_details_xml] != "N/A" {
          xml {
            source => "violation_details_xml"
            target => "violation_details"
          }
        }
        mutate {
          split => { "attack_type" => "," }
          split => { "sig_cves" => "," }
          split => { "sig_ids" => "," }
          split => { "sig_names" => "," }
          split => { "sig_set_names" => "," }
          split => { "staged_sig_cves" => "," }
          split => { "staged_sig_ids" => "," }
          split => { "staged_sig_names" => "," }
          split => { "staged_threat_campaign_names" => "," }
          split => { "sub_violations" => "," }
          split => { "threat_campaign_names" => "," }
          split => { "violations" => "," }
          remove_field => [
            "[violation_details][violation_masks]",
            "violation_details_xml",
            "message"
          ]
        }
        if [x_forwarded_for_header_value] != "N/A" {
          mutate { add_field => { "source_host" => "%{x_forwarded_for_header_value}"}}
        } else {
          mutate { add_field => { "source_host" => "%{ip_client}"}}
        }
        geoip {
          source => "source_host"
          target => "geoip"
        }
        ruby {
            code => "
                require 'base64';

                data = event.get('[violation_details]');

                def check64(value)
                  value.is_a?(String) && Base64.strict_encode64(Base64.decode64(value)) == value;
                end

                def iterate(key, i, event)
                  if i.is_a?(Hash)
                    i.each do |k, v|
                      if v.is_a?(Hash) || v.is_a?(Array)
                        newkey = key + '[' + k + ']';
                        iterate(newkey, v, event)
                      end
                    end
                  else if i.is_a?(Array)
                    i.each do |v|
                          iterate(key, v, event)
                    end
                  else
                    if check64(i)
                      event.set(key, Base64.decode64(i))
                    end
                  end
                end
                end
                iterate('[violation_details_b64decoded]', data, event)
            "
          }
      }
      output {
        elasticsearch {
          hosts => ["http://elasticsearch-master:9200"]
          index => "f5-waf-logs-%{+YYYY.MM.dd}"
        }
      }
    f5-ts.conf: |
      input {
          http {
              port => 8514
          }
      }
      filter {
          json {
              source => "message"
          }
          if "systemInfo" in [telemetryEventCategory] {
              date {
                  match => [ "system.systemTimestamp","MMM d, yyyy '@' HH:mm:ss.SSS" ]
                  target => "@eventTimestamp"
                  timezone => "UTC"
              }
          }
          if "LTM" in [telemetryEventCategory] {
              date {
                  match => [ "event_timestamp","MMM d, yyyy '@' HH:mm:ss.SSS" ]
                  target => "@eventTimestamp"
                  timezone => "UTC"
              }
              mutate {
                  split => {
                      "[headers][x_forwarded_for]" => ","
                      "[headers][x_real_ip]" => ","
                  }
                  convert => {
                      "[headers][content_length]" => "integer"
                      "[headers][x_forwarded_port]" => "integer"
                      "[http_statcode]" => "integer"
                      "[response_code]" => "integer"
                      "[response_ms]" => "integer"
                  }
              }
              geoip {
                  source => "[client_ip]"
                  target => "[client_geo]"
              }
          }
          if "AFM" in [telemetryEventCategory] {
              date {
                  match => [ "date_time","MMM d, yyyy '@' HH:mm:ss.SSS" ]
                  target => "@eventTimestamp"
                  timezone => "UTC"
              }
              mutate {
                  split => {
                      "[headers][x_forwarded_for]" => ","
                      "[headers][x_real_ip]" => ","
                  }
                  convert => {
                      "[dest_port]" => "integer"
                      "[headers][content_length]" => "integer"
                      "[headers][x_forwarded_port]" => "integer"
                      "[severity]" => "integer"
                  }
              }
              geoip {
                  source => "[dest_ip]"
                  target => "[dest_geo]"
              }
              geoip {
                  source => "[source_ip]"
                  target => "[source_geo]"
              }
          }
          if "ASM" in [telemetryEventCategory] {
              date {
                  match => [ "date_time","MMM d, yyyy '@' HH:mm:ss.SSS" ]
                  target => "@eventTimestamp"
                  timezone => "UTC"
              }
              date {
                  match => [[policy_apply_date], "yyyy-MM-dd HH:mm:ss"]
                  timezone => "UTC"
              }
              mutate {
                  split => {
                      "[headers][x_forwarded_for]" => ","
                      "[headers][x_real_ip]" => ","
                  }
                  convert => {
                      "[dest_port]" => "integer"
                      "[headers][content_length]" => "integer"
                      "[headers][x_forwarded_port]" => "integer"
                      "[response_code]" => "integer"
                      "[src_port]" => "integer"
                      "[violation_rating]" => "integer"
                  }
              }
              geoip {
                  source => "[dest_ip]"
                  target => "[dest_geo]"
              }
              geoip {
                  source => "[source_host]"
                  target => "[source_geo]"
              }
          }
          if "APM" in [telemetryEventCategory] {

          }
          if "ihealthInfo" in [telemetryEventCategory] {

          }
          if "AVR" in [telemetryEventCategory] {
              date {
                  match => [ "EOCTimestamp","UNIX" ]
                  target => "@eventTimestamp"
                  timezone => "UTC"
              }
              mutate {
                  split => {
                      "[headers][x_forwarded_for]" => ","
                      "[headers][x_real_ip]" => ","
                  }
                  split => {
                      "[LatencyHistogram]" => "|"
                  }
                  if [LatencyHistogram] {
                      split => {
                          "[LatencyHistogram][0]" => ","
                      }
                      rename => {
                          "[LatencyHistogram][0]" => "[LatencyHistogram][values]"
                      }
                      split => {
                          "[LatencyHistogram][1]" => ","
                      }
                      rename => {
                          "[LatencyHistogram][0]" => "[LatencyHistogram][counts]"
                      }
                  }
                  convert => {
                      "[headers][content_length]" => "integer"
                      "[headers][x_forwarded_port]" => "integer"
                      "[HitCount]" => "integer"
                      "[pid]" => "integer"
                      "[rss]" => "integer"
                      "[max_cpu_index]" => "integer"
                      "[proc_id]" => "integer"
                      "[AttackCount]" => "integer"
                      "[AvgBadActorDetection]" => "integer"
                      "[AvgDetection]" => "integer"
                      "[BadActorDrops]" => "integer"
                      "[BadActorEvents]" => "integer"
                      "[HardwareDrops]" => "integer"
                      "[MaxBadActorMitigation]" => "integer"
                      "[MaxMitigation]" => "integer"
                      "[MinBadActorMitigation]" => "integer"
                      "[MinMitigation]" => "integer"
                      "[SoftwareDrops]" => "integer"
                      "[TotalEvents]" => "integer"
                      "[WLEvents]" => "integer"

                      "[abandoned_conns]" => "integer"
                      "[accept_fails]" => "integer"
                      "[active_conns]" => "integer"
                      "[expired_conns]" => "integer"
                      "[failed_conns]" => "integer"
                      "[hw_cookie_valid]" => "integer"
                      "[max_active_conns]" => "integer"
                      "[new_conns]" => "integer"
                      "[SoftwareDrops]" => "integer"
                      "[TotalEvents]" => "integer"
                      "[WLEvents]" => "integer"

                      "[AvgDetection]" => "integer"
                      "[BadActorDrops]" => "integer"
                      "[BadActorEvents]" => "integer"
                      "[HardwareDrops]" => "integer"
                      "[MaxBadActorMitigation]" => "integer"
                      "[MaxMitigation]" => "integer"
                      "[MinBadActorMitigation]" => "integer"
                      "[MinMitigation]" => "integer"
                      "[SoftwareDrops]" => "integer"
                      "[TotalEvents]" => "integer"
                      "[WLEvents]" => "integer"

                      "[http_requests]" => "integer"
                      "[http_requests_limit]" => "integer"

                      "[AggrInterval]" => "integer"
                      "[bd_avg_cpu_util]" => "integer"
                      "[blade_num]" => "integer"
                      "[max_cpu_index]" => "integer"
                      "[SlotId]" => "integer"
                      "[tmm_avg_cpu_util]" => "integer"

                      "[enforced_entities_count]" => "integer"

                      "[accepted_count]" => "integer"
                      "[pending_highscore_count]" => "integer"
                      "[pending_lowscore_count]" => "integer"

                      "[bd_total_max_mem]" => "integer"
                      "[bd_total_mem_allocated]" => "integer"
                      "[bd_total_mem_used]" => "integer"
                      "[bd_total_xml_max_mem]" => "integer"
                      "[bd_total_xml_mem_used]" => "integer"
                      "[swap_size]" => "integer"
                      "[system_swap_size]" => "integer"
                      "[tmm_memory_total]" => "integer"
                      "[tmm_memory_used]" => "integer"
                      "[used_swap]" => "integer"

                      "[policy_changes_count]" => "integer"

                      "[SourcePort]" => "integer"
                      "[DestinationPort]" => "integer"

                      "[PacketsSize]" => "integer"

                      "[aborts]" => "integer"
                      "[total_executions]" => "integer"

                      "[client_bytes_in]" => "integer"
                      "[client_bytes_out]" => "integer"
                      "[client_concurrent_conns]" => "integer"
                      "[client_conns]" => "integer"
                      "[client_expired_conns]" => "integer"
                      "[client_pkts_in]" => "integer"
                      "[client_pkts_out]" => "integer"
                      "[server_bytes_in]" => "integer"
                      "[server_bytes_out]" => "integer"
                      "[server_concurrent_conns]" => "integer"
                      "[server_conns]" => "integer"
                      "[server_pkts_in]" => "integer"
                      "[server_pkts_out]" => "integer"

                      "[a_reqs]" => "integer"
                      "[aaaa_reqs]" => "integer"
                      "[any_reqs]" => "integer"
                      "[cname_reqs]" => "integer"
                      "[dns64fails]" => "integer"
                      "[dns64reqs]" => "integer"
                      "[dns64trans]" => "integer"
                      "[drops]" => "integer"
                      "[fast_dns_allowed]" => "integer"
                      "[fast_dns_drops]" => "integer"
                      "[fast_dns_queries]" => "integer"
                      "[fast_dns_resp_ne]" => "integer"
                      "[fast_dns_resp_nx]" => "integer"
                      "[fast_dns_resp_rf]" => "integer"
                      "[fast_dns_resp_tc]" => "integer"
                      "[fast_dns_responses]" => "integer"
                      "[hdr_aa]" => "integer"
                      "[hdr_ad]" => "integer"
                      "[hdr_ra]" => "integer"
                      "[hdr_tc]" => "integer"
                      "[hints]" => "integer"
                      "[hw_cache_lookups]" => "integer"
                      "[hw_cache_responses" => "integer"
                      "[hw_inspected]" => "integer"
                      "[hw_malformed]" => "integer"
                      "[malformed]" => "integer"
                      "[malicious]" => "integer"
                      "[mx_reqs]" => "integer"
                      "[naptr_reqs]" => "integer"
                      "[noerrors]" => "integer"
                      "[ns_reqs]" => "integer"
                      "[other_reqs]" => "integer"
                      "[ptr_reqs]" => "integer"
                      "[queries]" => "integer"
                      "[r_noerror]" => "integer"
                      "[r_nxdomain]" => "integer"
                      "[r_refused]" => "integer"
                      "[r_servfail]" => "integer"
                      "[rejects]" => "integer"
                      "[responses]" => "integer"
                      "[soa_reqs]" => "integer"
                      "[srv_reqs]" => "integer"
                      "[todns]" => "integer"
                      "[txt_reqs]" => "integer"

                      "[dropped]" => "integer"
                      "[err_cksum]" => "integer"
                      "[err_len]" => "integer"
                      "[err_mem]" => "integer"
                      "[err_opt]" => "integer"
                      "[err_proto]" => "integer"
                      "[err_reassembled_too_long]" => "integer"
                      "[err_rtx]" => "integer"
                      "[reassembled]" => "integer"
                      "[rx]" => "integer"
                      "[rx_frag]" => "integer"
                      "[rx_frag_dropped]" => "integer"
                      "[tx]" => "integer"
                      "[tx_frag]" => "integer"
                      "[tx_frag_dropped]" => "integer"

                      "[accept_fails]" => "integer"
                      "[accepts]" => "integer"
                      "[active_conns]" => "integer"
                      "[expired_conns]" => "integer"
                      "[failed_conns]" => "integer"
                      "[max_active_conns]" => "integer"
                      "[new_conns]" => "integer"
                      "[rxbaddgram]" => "integer"
                      "[rxbadsum]" => "integer"
                      "[rxdgram]" => "integer"
                      "[rxnosum]" => "integer"
                      "[rxunreach]" => "integer"
                      "[txdgram]" => "integer"
                      "[udp_prof]" => "integer"

                      "[free_ram]" => "integer"
                      "[free_swap]" => "integer"
                      "[other_free_ram]" => "integer"
                      "[other_total_ram]" => "integer"
                      "[other_used_ram]" => "integer"
                      "[tmm_free_ram]" => "integer"
                      "[tmm_total_ram]" => "integer"
                      "[tmm_used_ram]" => "integer"
                      "[total_ram]" => "integer"
                      "[total_swap]" => "integer"
                      "[used_ram]" => "integer"
                      "[used_swap]" => "integer"

                      "[avg_1min]" => "integer"
                      "[rd_bytes]" => "integer"
                      "[rd_lat_us]" => "integer"
                      "[rd_merged]" => "integer"
                      "[rd_ops]" => "integer"
                      "[total_ios]" => "integer"
                      "[wr_bytes]" => "integer"
                      "[wr_merged]" => "integer"
                      "[wr_ops]" => "integer"

                      "[client_conn_dur]" => "integer"
                      "[client_max_concurrent_conns]" => "integer"
                      "[cycle_count]" => "integer"
                      "[hw_syncookies]" => "integer"
                      "[hw_syncookies_accepts]" => "integer"
                      "[server_max_concurrent_conns]" => "integer"
                      "[stress]" => "integer"
                      "[stresscpu]" => "integer"
                      "[syncookies]" => "integer"
                      "[syncookies_accepts]" => "integer"
                      "[syncookies_rejects]" => "integer"
                      "[tot_requests]" => "integer"

                      "[translation_request_failures]" => "integer"
                      "[translation_requests]" => "integer"

                      "[active_translations]" => "integer"
                      "[backup_pool_translations]" => "integer"

                      "[cpu]" => "integer"
                      "[idle_ticks]" => "integer"
                      "[iowait]" => "integer"
                      "[irq]" => "integer"
                      "[nice]" => "integer"
                      "[softirq]" => "integer"
                      "[system_ticks]" => "integer"
                      "[user_ticks]" => "integer"

                      "[Requests]" => "integer"
                      "[TcDisabledRequests]" => "integer"
                      "[TcFiltersCheckPassedRequests]" => "integer"
                      "[TcMemoryCheckPassedRequests]" => "integer"
                      "[TcSamplingPassedRequest]" => "integer"
                      "[Tmm]" => "integer"

                      "[bytes_in]" => "integer"
                      "[bytes_out]" => "integer"

                      "[connq_age_head]" => "integer"
                      "[connq_age_head_max]" => "integer"
                      "[connq_depth]" => "integer"
                      "[connq_depth_max]" => "integer"
                      "[pool_port]" => "integer"
                      "[server_bytes_in]" => "integer"
                      "[server_bytes_out]" => "integer"
                      "[server_concurrent_conns]" => "integer"
                      "[server_conns]" => "integer"
                      "[server_max_concurrent_conns]" => "integer"
                      "[server_pkts_in]" => "integer"
                      "[server_pkts_out]" => "integer"
                      "[transactions]" => "integer"

                      "[counters_drops_in]" => "integer"
                      "[counters_drops_out]" => "integer"
                      "[counters_errors_in]" => "integer"
                      "[counters_errors_out]" => "integer"

                      "[ApplicationResponseTime]" => "integer"
                      "[ClientLatencyHitCount]" => "integer"
                      "[ClientLatencyTotal]" => "integer"
                      "[ClientSideNetworkLatency]" => "integer"
                      "[ClientTtfb]" => "integer"
                      "[ClientTtfbHitcount]" => "integer"
                      "[MaxApplicationResponseTime]" => "integer"
                      "[MaxClientSideNetworkLatency]" => "integer"
                      "[MaxClientTtfb]" => "integer"
                      "[MaxRequestDuration]" => "integer"
                      "[MaxResponseDuration]" => "integer"
                      "[MaxServerSideNetworkLatency]" => "integer"
                      "[MinApplicationResponseTime]" => "integer"
                      "[MinClientSideNetworkLatency]" => "integer"
                      "[MinClientTtfb]" => "integer"
                      "[MinRequestDuration]" => "integer"
                      "[MinResponseDuration]" => "integer"
                      "[MinServerSideNetworkLatency]" => "integer"
                      "[ResponseDuration]" => "integer"
                      "[RequestDurationHitcount]" => "integer"
                      "[ResponseDurationHitcount]" => "integer"
                      "[ServerHitcount]" => "integer"
                      "[ServerLatencyMax]" => "integer"
                      "[ServerLatencyMin]" => "integer"
                      "[ServerLatencyTotal]" => "integer"
                      "[ServerSideNetworkLatency]" => "integer"
                      "[SosApplicationResponseTime]" => "integer"
                      "[SosClientSideNetworkLatency]" => "integer"
                      "[SosClientTtfb]" => "integer"
                      "[SosRequestDuration]" => "integer"
                      "[SosResponseDuration]" => "integer"
                      "[SosServerSideNetworkLatency]" => "integer"
                      "[ThroughputReqTotalPerInterval]" => "integer"
                      "[ThroughputRespMaxPerSec]" => "integer"
                      "[ThroughputRespTotalPerInterval]" => "integer"
                      "[TPSMax]" => "integer"
                      "[UserSessionsConcurrentTotal]" => "integer"
                      "[UserSessionsNewTotal]" => "integer"
                  }
              }
              geoip {
                  source => "[client_ip]"
                  target => "[client_geo]"
              }

          }
      }
      output {
          if "systemInfo" in [telemetryEventCategory] {
              elasticsearch {
                  hosts => ["http://elasticsearch-master:9200"]
                  index => "f5-ts-stats-%{+YYYY.MM.dd}"
              }
          }
          if "LTM" in [telemetryEventCategory] {
              elasticsearch {
                  hosts => ["http://elasticsearch-master:9200"]
                  index => "f5-ts-events-ltm-%{+YYYY.MM.dd}"
              }
          }
          if "AFM" in [telemetryEventCategory] {
              elasticsearch {
                  hosts => ["http://elasticsearch-master:9200"]
                  index => "f5-ts-events-afm-%{+YYYY.MM.dd}"
              }
          }
          if "ASM" in [telemetryEventCategory] {
              elasticsearch {
                  hosts => ["http://elasticsearch-master:9200"]
                  index => "f5-ts-events-asm-%{+YYYY.MM.dd}"
              }
          }
          if "APM" in [telemetryEventCategory] {
              elasticsearch {
                  hosts => ["http://elasticsearch-master:9200"]
                  index => "f5-ts-events-apm-%{+YYYY.MM.dd}"
              }
          }
          if "ihealthInfo" in [telemetryEventCategory] {
              elasticsearch {
                  hosts => ["http://elasticsearch-master:9200"]
                  index => "f5-ts-events-ihealth-%{+YYYY.MM.dd}"
              }
          }
          if "AVR" in [telemetryEventCategory] {
              elasticsearch {
                  hosts => ["http://elasticsearch-master:9200"]
                  index => "f5-ts-events-avr-%{+YYYY.MM.dd}"
              }
          }
      }

elasticsearch:
  antiAffinity: "soft"
  replicas: 1
  minimumMasterNodes: 1
  resources:
    requests:
      memory: 4Gi
    limits:
      memory: 4Gi

kibana:
  lifecycle:
    postStart:
      exec:
        command:
          - bash
          - -c
          - |
            #!/bin/bash
            KB_URL=http://localhost:5601
            while [[ "$(curl -s -o /dev/null -w '%{http_code}\n' -L $KB_URL)" != "200" ]]; do sleep 1; done
            curl -XPOST "$KB_URL/api/kibana/dashboards/import" -H "Content-Type: application/json" -H 'kbn-xsrf: true' -d'{"objects":[{"type":"index-pattern","id":"f5-waf","attributes":{"title":"f5-waf-logs-*"}},{"type":"index-pattern","id":"f5-ts-stats","attributes":{"title":"f5-ts-stats-*","timeFieldName":"@eventTimestamp"}},{"type":"index-pattern","id":"f5-ts-events-ltm","attributes":{"title":"f5-ts-events-ltm-*","timeFieldName":"@eventTimestamp"}},{"type":"index-pattern","id":"f5-ts-events-afm","attributes":{"title":"f5-ts-events-afm-*","timeFieldName":"@eventTimestamp"}},{"type":"index-pattern","id":"f5-ts-events-asm","attributes":{"title":"f5-ts-events-asm-*","timeFieldName":"@eventTimestamp"}},{"type":"index-pattern","id":"f5-ts-events-avr","attributes":{"title":"f5-ts-events-avr-*","timeFieldName":"@eventTimestamp"}}]}'

prometheus:
  extraScrapeConfigs: |

  pushgateway:
    enabled: false

grafana:
  persistence:
    enabled: true
    type: pvc
    accessModes:
      - ReadWriteOnce
    size: 4Gi
    finalizers:
      - kubernetes.io/pvc-protection
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          url: http://dashboards-prometheus-server
          isDefault: true
        - name: Elasticsearch-WAF
          type: elasticsearch
          url: http://elasticsearch-master:9200
          database: "f5-waf-logs-*"
          jsonData:
            esVersion: "7.0+"
            timeField: "@timestamp"
        - name: Elasticsearch-TS-stats
          type: elasticsearch
          url: http://elasticsearch-master:9200
          database: "f5-ts-stats-*"
          jsonData:
            esVersion: "7.0+"
            timeField: "@timestamp"
        - name: Elasticsearch-TS-events-ltm
          type: elasticsearch
          url: http://elasticsearch-master:9200
          database: "f5-ts-events-ltm-*"
          jsonData:
            esVersion: "7.0+"
            timeField: "@timestamp"
        - name: Elasticsearch-TS-events-afm
          type: elasticsearch
          url: http://elasticsearch-master:9200
          database: "f5-ts-events-afm-*"
          jsonData:
            esVersion: "7.0+"
            timeField: "@timestamp"
        - name: Elasticsearch-TS-events-asm
          type: elasticsearch
          url: http://elasticsearch-master:9200
          database: "f5-ts-events-asm-*"
          jsonData:
            esVersion: "7.0+"
            timeField: "@timestamp"
        - name: Elasticsearch-TS-events-avr
          type: elasticsearch
          url: http://elasticsearch-master:9200
          database: "f5-ts-events-avr-*"
          jsonData:
            esVersion: "7.0+"
            timeField: "@timestamp"
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
        - name: "nginx"
          orgId: 1
          folder: "NGINX"
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/nginx
        - name: "security"
          orgId: 1
          folder: "Security"
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/security
  dashboards:
    nginx:
      nginxplus:
        url: https://raw.githubusercontent.com/rafaelsampaio/f5-monitoring/main/grafana/NGINXPlusICDashboard.json
        datasource: Prometheus
      nginxoss:
        url: https://raw.githubusercontent.com/rafaelsampaio/f5-monitoring/main/grafana/NGINXOSSICDashboard.json
        datasource: Prometheus
    security:
      f5waf:
        url: https://raw.githubusercontent.com/rafaelsampaio/f5-monitoring/main/grafana/WAFDashboard.json
        datasource: Elasticsearch-WAF
  service:
    type: NodePort
    nodePort: 32517

